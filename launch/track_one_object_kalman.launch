<launch>
    <!-- USB摄像头节点 -->
    <node pkg="usb_cam" type="usb_cam_node" name="usb_cam" output="screen">
        <param name="video_device" value="/dev/video4" />
        <param name="image_width" value="640" />
        <param name="image_height" value="480" />
        <param name="pixel_format" value="yuyv" />
        <param name="camera_frame_id" value="usb_cam" />
        <param name="io_method" value="mmap"/>
        <param name="framerate" value="30" />
        <remap from="usb_cam/image_raw" to="/camera/image_raw" />
    </node>

    <!-- 预测式振镜跟踪节点 -->
    <node pkg="laser_weeding" type="track_one_object_kalman.py" name="predictive_galvo_tracking_node" output="screen" required="true">
        <!-- 模型参数 -->
        <param name="model_type" value="yolov11" />
        <param name="model_path" value="/home/zhong/my_workspace/src/laser_weeding/weights/yolo11m.pt" />
        <param name="device" value="0" />

        <!-- 跟踪器参数 -->
        <param name="tracker_type" value="botsort" />

        <!-- 类别ID -->
        <param name="weed_class_id" value="64" />
        <param name="crop_class_id" value="0" />
        <param name="confidence_threshold" value="0.3" />

        <!-- 基本跟踪参数 -->
        <param name="min_confidence" value="0.3" />
        <param name="target_stable_frames" value="2" />

        <!-- 延迟补偿参数 (单位: 秒) -->
        <param name="total_system_delay" value="0.08" />       <!-- 总系统延迟80ms -->
        <param name="camera_delay" value="0.033" />            <!-- 相机延迟33ms -->
        <param name="processing_delay" value="0.02" />         <!-- 处理延迟20ms -->
        <param name="galvo_delay" value="0.01" />              <!-- 振镜延迟10ms -->
        <param name="communication_delay" value="0.005" />     <!-- 通信延迟5ms -->

        <!-- 预测参数 -->
        <param name="extra_prediction" value="0.02" />         <!-- 额外预测20ms -->
        <param name="max_prediction_distance" value="100" />   <!-- 最大预测距离 -->
        <param name="use_kalman_filter" value="true" />        <!-- 使用卡尔曼滤波 -->

        <!-- 串口参数 -->
        <param name="serial_port" value="/dev/ttyACM0" />
        <param name="serial_baudrate" value="115200" />

        <!-- 图像参数 -->
        <param name="image_width" value="640" />
        <param name="image_height" value="480" />
    </node>
</launch>