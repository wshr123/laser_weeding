<launch>
    <!-- 引入 RealSense 相机（对齐深度到彩色，关闭点云，启用同步） -->
    <env name="LRS_LOG_LEVEL" value="ERROR"/>
    <include file="$(find realsense2_camera)/launch/rs_camera.launch">
      <arg name="align_depth" value="true"/>
      <arg name="enable_pointcloud" value="false"/>
      <arg name="enable_sync" value="false"/>
      <arg name="camera" value="camera"/>

      <arg name="color_width"  value="1280"/>
      <arg name="color_height" value="720"/>
      <arg name="color_fps"    value="30"/>
      <arg name="depth_width"  value="1280"/>
      <arg name="depth_height" value="720"/>
      <arg name="depth_fps"    value="30"/>

      <arg name="initial_reset" value="false"/>
    </include>


    <!-- 激光除草节点 -->
    <node pkg="laser_weeding" type="main.py" name="laser_weeding_node" output="screen" required="true">
        <!-- 模型参数 -->
        <param name="model_type" value="yolov11" />
        <param name="model_path" value="/home/zhong/my_workspace/src/laser_weeding/weights/yolo11m.pt" />
        <param name="device" value="0" />
        <param name="tracker_type" value="bytetrack" />

        <!-- 检测参数 -->
        <param name="weed_class_id" value="64" />
        <param name="confidence_threshold" value="0.3" />

        <!-- 核心预测参数 -->
        <param name="total_delay" value="0.08" />
        <param name="prediction_time" value="0.5" />
        <param name="use_kalman" value="true" />
        <param name="max_prediction_distance" value="200" />

        <!-- 激光控制 -->
        <param name="aiming_time" value="5000" />
        <param name="laser_time" value="0.4" />

        <!-- 振镜参数 -->
        <param name="serial_port" value="/dev/ttyACM0" />
        <param name="serial_baudrate" value="115200" />
        <param name="min_move_step" value="0" />

        <!-- 图像与深度话题 -->
        <param name="image_width" value="1280" />
        <param name="image_height" value="720" />
        <param name="image_topic" value="/camera/color/image_raw" />
        <param name="camera_info_topic" value="/camera/color/camera_info" />
        <param name="depth_image_topic" value="/camera/aligned_depth_to_color/image_raw" />

        <!-- 目标管理 -->
        <param name="target_timeout" value="0.3" />
        <param name="min_stable_frames" value="1" />

        <!-- 坐标变换模式 -->
        <param name="use_3d_transform" value="true" />
        <param name="transform_config_file" value="$(find laser_weeding)/yaml/cam_params.yaml" />

    </node>
</launch>